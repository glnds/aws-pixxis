# vim:ft=ansible:
---
- name: launch a new bastion host 
  ec2:
    image: ami-6975eb1e
    instance_type: t2.micro
    vpc_subnet_id: "{{ vpc_subnet_id }}"
    key_name: "{{ key_name }}"
    group: BastionSG
    instance_tags: {Name: "{{ instance_name_prefix }}bastion", Type: Bastion, Stack: "{{ stack }}"}
    assign_public_ip: yes
    profile: "{{ profile }}"
    region: "{{ region }}"
    source_dest_check: False
    wait: yes
    exact_count: 1
    count_tag: {Type: Bastion}
  register: ec2_bastion

- name: Set DNS Record for New Instance
  route53: 
    # profile: "{{ profile }}"
    # region: "{{ region }}"
    command: create
    zone: "{{ zone }}"
    record: "{{ instance_name_prefix }}bastion.{{ zone }}"
    type: A
    ttl: 7200
    value: "{{ ec2_bastion.tagged_instances[0].public_ip }}"
